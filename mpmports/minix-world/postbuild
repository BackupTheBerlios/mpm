set -e

PATH=/bin:/usr/bin:/usr/X11R6/bin:/usr/local/bin
export PATH

cd "$SMPM_BUILDROOT"

echo "*** copying relevant files to installroot"
find . -cnewer timestamp | egrep -v "^./(usr/src|dev|tmp)" | pax -w -d | \
    (cd "$SMPM_INSTALLROOT"; pax -r -p e )

# there is no (f)lex in world
rm -f "$SMPM_INSTALLROOT/usr/man/man1/flex.1"
rm -f "$SMPM_INSTALLROOT/usr/man/man1/flexdoc.1"

# minix 3.1.2a world does not build /usr/lib/i86 so copy them from chroot jail
cp -pr usr/lib/i86 "$SMPM_INSTALLROOT/usr/lib"

# binary_sizes
cp -p etc/binary_sizes* "$SMPM_INSTALLROOT/etc"

# /usr/lib/ego --> copy
cp -pr usr/lib/ego "$SMPM_INSTALLROOT/usr/lib"

# default keymap is us-std.map
cp -p usr/lib/keymaps/us-std.map "$SMPM_INSTALLROOT/etc/keymap"

# /usr/lib/m2 is not included in minix 3.1.2 sources
cd "$SMPM_INSTALLROOT/usr/lib"
mkdir m2
cd m2
tar xf "$SMPM_FILES/m2defs.tar"

# fonts are not included in minix 3.1.2 sources
cd "$SMPM_INSTALLROOT/usr/lib"
mkdir fonts
cd fonts
tar xf "$SMPM_FILES/fonts.tar"

# fonts are not included in minix 3.1.2 sources
cd "$SMPM_INSTALLROOT/usr/lib"
mkdir dict
cd dict
tar xf "$SMPM_FILES/dict.tar"

# descr, version, fortune.dat, fstab and motd are not build so copy them
cp -p "$SMPM_FILES/descr" "$SMPM_INSTALLROOT/usr/lib"
cp -p "$SMPM_FILES/motd" "$SMPM_INSTALLROOT/etc"
cp -p "$SMPM_FILES/version" "$SMPM_INSTALLROOT/etc"
cp -p "$SMPM_FILES/fstab" "$SMPM_INSTALLROOT/etc"
cp -p "$SMPM_FILES/fortune.dat" "$SMPM_INSTALLROOT/usr/lib"
cp -p "$SMPM_FILES/binary_sizes" "$SMPM_INSTALLROOT/etc"
cp -p "$SMPM_FILES/binary_sizes.big" "$SMPM_INSTALLROOT/etc"
cp -p "$SMPM_FILES/binary_sizes.xxl" "$SMPM_INSTALLROOT/etc"

# no /usr/gnu directory. it will be created if any gnu-* packages are installed
rm -rf "$SMPM_INSTALLROOT/usr/gnu"

exit 0
