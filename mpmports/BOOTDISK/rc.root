#!/bin/sh
set -e

PATH=/bin:/usr/bin
export PATH

_green="[32m" _red="[31m" _normal="[0m"

echo ""
echo -n "Starting /dev/rescue, size 4096kB: "
service up /bin/rescue -dev /dev/rescue -args 4096 -period 4HZ
echo "${_green}ok$_normal"

echo -n "Uncompressing image to /dev/rescue: "
bzip2 -dc /usr.bz2 > /dev/rescue
echo "${_green}ok$_normal"

echo -n "Mounting /dev/rescue as /usr: "
mount /dev/rescue /usr > /dev/null || { echo "${_red}ERROR"; false; }
echo "${_green}ok$_normal"

# continue setup here:
# exec /bin/sh /usr/etc/rc

echo ""
intr /bin/sh -i
